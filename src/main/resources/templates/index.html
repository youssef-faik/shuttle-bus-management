<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org/"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout}">
<head>
  <title>Accueil</title>
  <style >
    .btn-srch, .btn-sub { background: #ffd367 !important; }
  </style>
</head>
<body>
  <div layout:fragment="main_content">
    <div class="row mt-3">
      <div class="col-10 col-lg-4 col-xxl-4 offset-1 offset-lg-1 offset-xxl-2 mt-5 mb-2" >
        <div class="card text-bg-dark">
          <div class="card-header text-center fs-5  fw-bold">Rechercher une offre d'abonnement</div>
            <form
                    method="get"
                    th:action="@{/(departureCity=${offer.departureCity}, arrivalCity=${offer.arrivalCity}, startDate=${offer.startDate}, endDate=${offer.endDate})}"
            >
            <div class="card-body">
              <div class="row">
                <div class="col-6 col-lg-12 col-xxl-6">
                  <p class="fw-bold">Mon trajet</p>
                  <!--start select ville depart-->
                  <div class="mb-3 form-border-transparent form-fs-lg bg-light rounded-3  p-3">
                    <label for="ville-depart" class="form-label text-dark">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-geo-alt" viewBox="0 0 16 16">
                        <path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A31.493 31.493 0 0 1 8 14.58a31.481 31.481 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94zM8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10z"/>
                        <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                      </svg>
                      Départ
                    </label>
                    <select id="ville-depart" class="form-select" required th:field="${offer.departureCity}">
                      <option value="" hidden >Choisissez une ville</option>
                      <option th:each="city : ${cities}" th:value="${city.id}" th:text="${city.name}"></option>
                    </select>
                  </div>
                  <!--end select ville depart-->
              
                  <!--start select ville arrivée-->
                  <div class="mb-3 form-border-transparent form-fs-lg bg-light rounded-3  p-3">
                    <label for="ville-arrive" class="form-label text-dark"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send" viewBox="0 0 16 16">
                      <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
                    </svg>
                      Arrivée
                    </label>
                    <select id="ville-arrive" class="form-select" required th:field="${offer.arrivalCity}">
                      <option value="" hidden >Choisissez une ville</option>
                      <option th:each="city : ${cities}" th:value="${city.id}" th:text="${city.name}"></option>
                    </select>
                  </div>
                  <!--start select ville arrivée-->
                  
                </div>
                <div class="col-6 col-lg-12 col-xxl-6">
              
                  <p class="fw-bold">Mes dates</p>
                  <!--start date debut-->
                  <div class="mb-3 form-border-transparent form-fs-lg bg-light rounded-3  p-3">
                    <label class="form-label text-dark" for="date_debut">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar-date" viewBox="0 0 16 16">
                        <path d="M6.445 11.688V6.354h-.633A12.6 12.6 0 0 0 4.5 7.16v.695c.375-.257.969-.62 1.258-.777h.012v4.61h.675zm1.188-1.305c.047.64.594 1.406 1.703 1.406 1.258 0 2-1.066 2-2.871 0-1.934-.781-2.668-1.953-2.668-.926 0-1.797.672-1.797 1.809 0 1.16.824 1.77 1.676 1.77.746 0 1.23-.376 1.383-.79h.027c-.004 1.316-.461 2.164-1.305 2.164-.664 0-1.008-.45-1.05-.82h-.684zm2.953-2.317c0 .696-.559 1.18-1.184 1.18-.601 0-1.144-.383-1.144-1.2 0-.823.582-1.21 1.168-1.21.633 0 1.16.398 1.16 1.23z"/>
                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                      </svg>
                      Début
                    </label>
                    <input type="date" class="form-control" id="date_debut" required  th:field="${offer.startDate}">
                  </div>
                  <!--end date debut-->
              
                  <!--start date fin-->
                  <div class="mb-3 form-border-transparent form-fs-lg bg-light rounded-3  p-3">
                    <label class="form-label text-dark" for="date_fin">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar-date" viewBox="0 0 16 16">
                        <path d="M6.445 11.688V6.354h-.633A12.6 12.6 0 0 0 4.5 7.16v.695c.375-.257.969-.62 1.258-.777h.012v4.61h.675zm1.188-1.305c.047.64.594 1.406 1.703 1.406 1.258 0 2-1.066 2-2.871 0-1.934-.781-2.668-1.953-2.668-.926 0-1.797.672-1.797 1.809 0 1.16.824 1.77 1.676 1.77.746 0 1.23-.376 1.383-.79h.027c-.004 1.316-.461 2.164-1.305 2.164-.664 0-1.008-.45-1.05-.82h-.684zm2.953-2.317c0 .696-.559 1.18-1.184 1.18-.601 0-1.144-.383-1.144-1.2 0-.823.582-1.21 1.168-1.21.633 0 1.16.398 1.16 1.23z"/>
                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                      </svg>
                      Fin
                    </label>
                    <input type="date" class="form-control" id="date_fin" th:field="${offer.endDate}">
                  </div>
                  <!--end date fin-->
            
                </div>
              </div>
            </div>
            
          <div class="card-footer">
            <button type="submit" class="btn-srch fw-bold text-black btn w-100">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
              </svg>
              Rechercher
            </button>
          </div>
          
          </form>
        </div>
        
    
      </div>
  
      <div class="col-10 col-lg-6 col-xxl-4 offset-1 offset-lg-0 mt-5 mt-lg-0 ">
        <div class="text-center">
          <h2 class="fw-bold mb-2 mb-lg-2">Les offres des abonnements</h2>
        </div>
  
        <div th:if="${#lists.isEmpty(offers)}">
          <div class="alert alert-dark" role="alert">
            <h4 class="alert-heading">Aucun abonnement n'est disponible !</h4>
            <hr>
            <a th:href="@{/client/add_request}" class="card-link">Cliquez-ici pour exprimer une demande pour un éventuel abonnement</a>
          </div>
        </div>
        <div th:unless="${#lists.isEmpty(offers)}">
          <div class="vstack gap-3">
          <div  class="card text-bg-dark crd mb-3"  th:each="offer : ${offers}" >
            <div class="row g-0">
              <form th:action="@{'/client/subscribe/' + ${offer.id}}" method="post">
                <div class="card-header">
                  <div class="row">
                    <div class="col fw-bold" th:text="${'Offert par : ' + offer.offeringCompany.name.toUpperCase()}"></div>
                    <div class="col text-end fw-bold" th:text="${offer.open? 'Status : Ouverte' : 'Status : Fermé'}"></div>
                  </div>
                </div>
                
                <div class="card-body text-center">
                  <div class="row">
                    <div class="col">
                      <p class="card-text"><small class="">Départ</small></p>
                      <p class="card-text fs-5 fw-bold" th:text="${#dates.format(offer.departureHour, 'HH:mm')}"></p>
                      <p class="card-text text-capitalize fw-light" th:text="${offer.departureCity.name}"></p>
                    </div>
                    <div class="col">
                      <p class="card-text"><small class="">Arrivée</small></p>
                      <p class="card-text fs-5 fw-bold" th:text="${#dates.format(offer.arrivalHour, 'HH:mm')}"></p>
                      <p class="card-text text-capitalize fw-light" th:text="${offer.arrivalCity.name}"></p>
                    </div>
                    <div class="col border-start border-light ">
                      <p class="card-text"><small class="">Date début</small></p>
                      <p class="card-text fs-6 fw-bold" th:text="${#dates.format(offer.startDate, 'dd MMM yyyy')}"></p>
                      <p class="card-text"><small class="">Date fin</small></p>
                      <p class="card-text fs-6 fw-bold" th:text="${#dates.format(offer.endDate, 'dd MMM yyyy')}"></p>
                    </div>
                  </div>
                  
                  <hr>
                  
                  <div th:if="${offer.busDescription != null and offer.busDescription.length() > 0}" class="row">
                      <div class="accordion">
                        <div class="accordion-item">
                          <h2 class="accordion-header" id="flush-headingOne">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" th:data-bs-target="${'#offerModal' + offer.id}" aria-expanded="false" aria-controls="flush-collapseOne">
                              Déscription de l'autobus
                            </button>
                          </h2>
                          <div th:id="${'offerModal' + offer.id}" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                            <div class="accordion-body">
                              <p class="" th:text="${offer.busDescription}"></p>
                            </div>
                          </div>
                        </div>
                        <hr>
  
                      </div>
                    </div>
                  <div class="row text-center">
  
                  <div class="col">
                      <p class="card-text"><small class="">Nombre place disponibles</small></p>
                      <p class="card-text fs-6 fw-bold" th:text="${offer.desiredNumberOfSubscribers - offer.clients.size()}"></p>
                    </div>
                    <div class="col">
                      <p class="card-text"><small class="">Prix</small></p>
                      <p class="card-text fs-6 fw-bold" th:text="${offer.price} + ' DH'"></p>
                    </div>
                  </div>
                </div>
            
                <div class="card-footer text-center" sec:authorize="!hasAuthority('company')">
                  <button type="submit" class="fw-bold fs-6 btn btn-sub w-100">S'abonner</button>
<!--                  <button th:if="${client == null or !client.subscriptions.contains(offer)}" type="submit" class="fw-bold fs-6 btn btn-sub w-100">S'abonner</button>-->
<!--                  <button th:unless="${client != null and client.subscriptions.contains(offer)}" type="submit" class="fw-bold fs-6 btn btn-secondary w-100">Désabonner</button>-->
                </div>
              </form>
            </div>
          </div>
        </div>
        
        </div>
      </div>
      
    </div>
    
    <script>document.getElementById('date_debut').valueAsDate = new Date();</script>
  </div>
</body>
</html>

